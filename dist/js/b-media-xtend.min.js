/**
 * b-media-xtend
 * @version 0.0.1
 * @copyright 2017 blogg.no
 * @license (MIT OR Apache-2.0)
 */
!function(e,t,n){"use strict";var o=t.mediaLang,i=t.helpers,a=function(e,t){if(console.log("bMediaXtend:",e),e.option.player){var a=[],l=0,r=0,c=function(e,t){var n=i.createElement("a",{title:t,href:"javascript:void(0)",class:"media-icon"});n.addEventListener("click",function(t){t.stopPropagation(),i.$(document).find(e+".drawer").removeClass("open")}),n.innerHTML="&times;";var o=i.createElement("div",{class:"media-close text-muted"});o.appendChild(n),i.$(document).find(e).prepend(o).on("click",function(e){e.stopPropagation()})},d=function(){var e=document.querySelector("#shareBtn");e&&(e.style.display="inline-block",c(".media-share",o("CLOSE_SHARE")),i.$(document).find("#inputEmbedScript, #inputEmbedIframe").on("focus",function(){var e=this;e.previousElementSibling.style.display="none",n.setTimeout(function(){e.setSelectionRange(0,e.value.length)})}).on("blur",function(){this.previousElementSibling.removeAttribute("style")}))},u=function(t){i.$(t).find(".media-title a, .media-playlist__header__title a").on("click",function(t){t.stopPropagation(),e.option.player.pause()})},s=function(){var t=e.option.element.nextElementSibling;t&&(e.option.element.appendChild(t),u(t))},p=function(){var t=i.$(document);t.find("[data-embutton]").on("click",function(n){switch(n.stopPropagation(),this.id){case"downloadBtn":return e.playsAPICall(),!0;default:var o=t.find(".drawer[data-btnid="+this.id+"]");this.id&&o.elements.length>0&&(o.addClass("open"),e.option.player.pause())}return!1})},m=function(){e.option.element.parentElement&&(i.$(e.option.element.parentElement).find(".media-share .buttons a").on("click",function(e){return e.stopPropagation(),!!this.classList.contains("email")||(i.openWindow(this.href,this.class,{width:500,height:400}),!1)}),d())},f=function(t){for(var o=[],a=0;a<t.length;a++)if(o[a]=t[a].href,n.location.href.indexOf(t[a].href)>-1){var r=t[a].parentElement;r.classList.add("currently-playing"),l=a,a>0&&!i.detectmob()&&(e.initAds(),e.option.player.autoplay(!0))}return o},y=function(){var e=document.querySelector(".media-playlist__header__info span");e.innerHTML=l+1+"/"+a.length},v=function(){var e=document.querySelector("#playListBtn");e&&(e.style.display="inline-block",c(".media-playlist",o("CLOSE_PLAYLIST")))},h=function(){if(void 0!==typeof localStorage&&void 0!==localStorage.autoplayPlaylist){var e=JSON.parse(localStorage.autoplayPlaylist);return document.querySelector("#mediaAutoplay").checked=e,e}return document.querySelector("#mediaAutoplay").checked},g=function(){var e=document.querySelector("#mediaAutoplay");if(e)if(void 0!==typeof localStorage){var t=h();localStorage.setItem("autoplayPlaylist",t),e.addEventListener("change",function(){localStorage.setItem("autoplayPlaylist",e.checked)})}else console.log("Sorry! No Web Storage support..")},S=function(){var n=i.$(document).find(".media-playlist__tracks li .media-playlist__"+e.option.type).elements;n.length>0&&(a=f(n),"video"==e.option.type&&(t?v():g()),y())},b=function(e){if("string"==typeof e){var t=i.createElement("textarea",{style:{position:"absolute",left:"-9999px",top:"0"}});t.value=e,document.body.appendChild(t),t.focus(),t.setSelectionRange(0,t.value.length);try{var n=document.execCommand("copy"),o=n?"successful":"unsuccessful";console.log("Copying text command was "+o)}catch(e){console.log("Oops, unable to copy")}t.parentNode.removeChild(t)}},E=function(){n.clearTimeout(r);var e=document.querySelector("#circulerTimer");e&&(e.parentNode.removeChild(e),document.querySelector(".vjs-big-play-button").removeAttribute("style"))},C=function(){var t='<div id="circulerTimer" class="radial-timer s-animate"><div class="radial-timer-half"></div><div class="radial-timer-half"></div></div>',n=document.createElement("div");n.innerHTML=t,e.option.element.appendChild(n.children.circulerTimer);var o=document.querySelector(".vjs-big-play-button");o.style.zIndex=1112,o.style.backgroundColor="transparent"},_=function(){E()},P=function(){E();var o=3e3,c=a[l+1];if(c){if(i.detectmob()||"video"==e.option.type&&!t&&!h())return;"video"==e.option.type&&(e.removeAds(),C()),r=n.setTimeout(function(){n.location.href=c}.bind(this),o)}};"video"==e.option.type&&(t&&s(),e.option.player.contextmenuUI({content:[{label:o("COPY_SCRIPT"),listener:function(){b(document.querySelector("#inputEmbedScript").value)}},{label:o("COPY_EMBED"),listener:function(){b(document.querySelector("#inputEmbedIframe").value)}}]})),e.option.player.on("play",_),e.option.player.on("ended",P),t&&p(),t&&m(),S()}};n.bMediaXtend=a||{}}(videojs,emUtils,window);