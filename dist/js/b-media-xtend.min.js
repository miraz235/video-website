/**
 * b-media-xtend
 * @version 0.0.1
 * @copyright 2017 blogg.no
 * @license (MIT OR Apache-2.0)
 */
!function(e,t,n){"use strict";var i=t.mediaLang,o=t.helpers,a=function(e,t){if(e.option.player){var a={nexMediaUrl:"",listLength:0,currentMediaIndex:0},l=0,r=function(e,t){var n=o.createElement("a",{title:t,href:"javascript:void(0)",class:"media-icon"});n.addEventListener("click",function(t){t.stopPropagation(),o.$(document).find(e+".drawer").removeClass("open")}),n.innerHTML="&times;";var i=o.createElement("div",{class:"media-close text-muted"});i.appendChild(n),o.$(document).find(e).prepend(i).on("click",function(e){e.stopPropagation()})},c=function(){var e=document.querySelector("#shareBtn");e&&(e.style.display="inline-block",r(".media-share",i("CLOSE_SHARE")),o.$(document).find("#inputEmbedScript, #inputEmbedIframe").on("focus",function(){var e=this;e.previousElementSibling.style.display="none",n.setTimeout(function(){e.setSelectionRange(0,e.value.length)})}).on("blur",function(){this.previousElementSibling.removeAttribute("style")}))},d=function(t){o.$(t).find(".media-title a, .media-playlist__header__title a").on("click",function(t){t.stopPropagation(),e.option.player.pause()})},s=function(){var t=e.option.element.nextElementSibling;t&&(e.option.element.appendChild(t),d(t))},u=function(){var t=o.$(document);t.find("[data-embutton]").on("click",function(n){switch(n.stopPropagation(),this.id){case"downloadBtn":return e.playsAPICall(),!0;default:var i=t.find(".drawer[data-btnid="+this.id+"]");this.id&&i.elements.length>0&&(i.addClass("open"),e.option.player.pause())}return!1})},p=function(){e.option.element.parentElement&&(o.$(e.option.element.parentElement).find(".media-share .buttons a").on("click",function(e){return e.stopPropagation(),!!this.classList.contains("email")||(o.openWindow(this.href,this.class,{width:500,height:400}),!1)}),c())},m=function(t){for(var i=0;i<t.length;i++)if(n.location.href.indexOf(t[i].href)>-1){var l=t[i].parentElement;l.classList.add("currently-playing"),a.currentMediaIndex=i+1,l.parentElement.scrollTop=l.offsetTop-l.scrollHeight/2,i>0&&!o.detectmob()&&(e.initAds(),e.option.player.autoplay(!0));break}a.listLength=t.length,!a.currentMediaIndex&&t.length&&(a.currentMediaIndex=1,t[0].parentElement.classList.add("currently-playing")),a.currentMediaIndex<a.listLength&&(a.nexMediaUrl=t[a.currentMediaIndex].href)},f=function(){var e=document.querySelector(".media-playlist__header__info span");e.innerHTML=a.currentMediaIndex+"/"+a.listLength},y=function(){var e=document.querySelector("#playListBtn");e&&(e.style.display="inline-block",r(".media-playlist",i("CLOSE_PLAYLIST")))},v=function(){if(void 0!==typeof localStorage&&void 0!==localStorage.autoplayPlaylist){var e=JSON.parse(localStorage.autoplayPlaylist);return document.querySelector("#mediaAutoplay").checked=e,e}return document.querySelector("#mediaAutoplay").checked},h=function(){var e=document.querySelector("#mediaAutoplay");if(e)if(void 0!==typeof localStorage){var t=v();localStorage.setItem("autoplayPlaylist",t),e.addEventListener("change",function(){localStorage.setItem("autoplayPlaylist",e.checked)})}else console.log("Sorry! No Web Storage support..")},g=function(){var n=o.$(document).find(".media-playlist__tracks li .media-playlist__"+e.option.type).elements;n.length>0&&(m(n),"video"==e.option.type&&(t?y():h()),f())},S=function(e){if("string"==typeof e){var t=o.createElement("textarea",{style:{position:"absolute",left:"-9999px",top:"0"}});t.value=e,document.body.appendChild(t),t.focus(),t.setSelectionRange(0,t.value.length);try{var n=document.execCommand("copy"),i=n?"successful":"unsuccessful";console.log("Copying text command was "+i)}catch(e){console.log("Oops, unable to copy")}t.parentNode.removeChild(t)}},b=function(){n.clearTimeout(l);var e=document.querySelector("#circulerTimer");e&&(e.parentNode.removeChild(e),document.querySelector(".vjs-big-play-button").removeAttribute("style"))},E=function(){var t='<div id="circulerTimer" class="radial-timer s-animate"><div class="radial-timer-half"></div><div class="radial-timer-half"></div></div>',n=document.createElement("div");n.innerHTML=t,e.option.element.appendChild(n.children.circulerTimer);var i=document.querySelector(".vjs-big-play-button");i.style.zIndex=1112,i.style.backgroundColor="transparent"},x=function(){b()},L=function(){b();var i=3e3;if(a.nexMediaUrl){if(o.detectmob()||"video"==e.option.type&&!t&&!v())return;"video"==e.option.type&&(e.removeAds(),E()),l=n.setTimeout(function(){n.location.href=a.nexMediaUrl}.bind(this),i)}};"video"==e.option.type&&(t&&s(),e.option.player.contextmenuUI({content:[{label:i("COPY_SCRIPT"),listener:function(){S(document.querySelector("#inputEmbedScript").value)}},{label:i("COPY_EMBED"),listener:function(){S(document.querySelector("#inputEmbedIframe").value)}}]})),e.option.player.on("play",x),e.option.player.on("ended",L),t&&u(),t&&p(),g()}};n.bMediaXtend=a||{}}(videojs,emUtils,window);